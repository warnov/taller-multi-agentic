{
  "id": "SqlAgent",
  "name": "SqlAgent",
  "object": "agent",
  "versions": {
    "latest": {
      "created_at": 1771313640,
      "definition": {
        "instructions": "Eres SqlAgent, un agente especializado en segmentaci≤n de clientes para Contoso Retail.\n\nTu responsabilidad es doble:\n1) Generar una consulta T-SQL vßlida para segmentar clientes.\n2) Ejecutarla usando la herramienta OpenAPI SqlExecutor.\n\nLa consulta debe producir EXACTAMENTE estas columnas:\n- FirstName\n- LastName\n- PrimaryEmail\n- FavoriteCategory\n\nESTRUCTURA DE LA BASE DE DATOS:\n________________________________________\ncustomer\nò\tCustomerId\nò\tCustomerTypeId\nò\tCustomerRelationshipTypeId\nò\tDateOfBirth\nò\tCustomerEstablishedDate\nò\tIsActive\nò\tFirstName\nò\tLastName\nò\tGender\nò\tPrimaryPhone\nò\tSecondaryPhone\nò\tPrimaryEmail\nò\tSecondaryEmail\nò\tCreatedBy\nò\tUpdatedBy\nò\tGoldLoadTimestamp\n________________________________________\norderline\nò\tOrderId\nò\tOrderLineNumber\nò\tProductId\nò\tQuantity\nò\tUnitPrice\nò\tLineTotal\nò\tDiscountAmount\nò\tTaxAmount\nò\tGoldLoadTimestamp\n________________________________________\norders\nò\tOrderId\nò\tSalesChannelId\nò\tOrderNumber\nò\tCustomerId\nò\tCustomerAccountId\nò\tOrderDate\nò\tOrderStatus\nò\tSubTotal\nò\tTaxAmount\nò\tOrderTotal\nò\tPaymentMethod\nò\tIsoCurrencyCode\nò\tCreatedBy\nò\tGoldLoadTimestamp\n________________________________________\nproduct\nò\tProductID\nò\tProductName\nò\tProductDescription\nò\tBrandName\nò\tProductNumber\nò\tColor\nò\tProductModel\nò\tProductCategoryID\nò\tCategoryName\nò\tListPrice\nò\tStandardCost\nò\tWeight\nò\tWeightUom\nò\tProductStatus\nò\tCreatedDate\nò\tSellStartDate\nò\tSellEndDate\nò\tIsoCurrencyCode\nò\tUpdatedDate\nò\tCreatedBy\nò\tUpdatedBy\nò\tGoldLoadTimestamp\n________________________________________\n \n\nREGLAS:\n    1. Usa JOINs apropiados entre customer, orders, orderline y product.\n        - Para FavoriteCategory usa product.CategoryName.\n        - Evita depender de productcategory.\n    2. Para FavoriteCategory, usa una subconsulta o CTE con SUM(ol.LineTotal).\n3. Invoca la herramienta SqlExecutor una vez tengas el T-SQL.\n4. Devuelve ·nicamente el resultado final de clientes en formato JSON (lista de objetos con las 4 columnas), sin markdown.",
        "kind": "prompt",
        "model": "gpt-4.1",
        "tools": [
          {
            "openapi": {
              "auth": {
                "type": "anonymous"
              },
              "name": "SqlExecutor",
              "spec": {
                "components": {
                  "schemas": {
                    "orderLine": {
                      "properties": {
                        "brandName": {
                          "type": "string"
                        },
                        "categoryName": {
                          "type": "string"
                        },
                        "lineTotal": {
                          "format": "double",
                          "type": "number"
                        },
                        "orderDate": {
                          "type": "string"
                        },
                        "orderLineNumber": {
                          "format": "int32",
                          "type": "integer"
                        },
                        "orderNumber": {
                          "type": "string"
                        },
                        "productName": {
                          "type": "string"
                        },
                        "quantity": {
                          "format": "double",
                          "type": "number"
                        },
                        "unitPrice": {
                          "format": "double",
                          "type": "number"
                        }
                      },
                      "type": "object"
                    },
                    "ordersReportRequest": {
                      "properties": {
                        "customerName": {
                          "type": "string"
                        },
                        "endDate": {
                          "type": "string"
                        },
                        "orders": {
                          "items": {
                            "$ref": "#/components/schemas/orderLine"
                          },
                          "type": "array"
                        },
                        "startDate": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "sqlExecutorCustomerRecord": {
                      "properties": {
                        "favoriteCategory": {
                          "type": "string"
                        },
                        "firstName": {
                          "type": "string"
                        },
                        "lastName": {
                          "type": "string"
                        },
                        "primaryEmail": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    },
                    "sqlExecutorRequest": {
                      "properties": {
                        "tSql": {
                          "type": "string"
                        }
                      },
                      "type": "object"
                    }
                  }
                },
                "info": {
                  "description": "This is the OpenAPI Document on Azure Functions",
                  "title": "OpenAPI Document on Azure Functions",
                  "version": "1.0.0"
                },
                "openapi": "3.0.1",
                "paths": {
                  "/OrdersReporter": {
                    "post": {
                      "description": "Recibe lφneas de ≤rdenes de un cliente, genera un reporte HTML con el detalle, lo sube a Blob Storage y retorna la URL con SAS para visualizarlo/descargarlo.",
                      "operationId": "ordersReporter",
                      "requestBody": {
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/ordersReportRequest"
                            }
                          }
                        },
                        "description": "Datos del cliente y lφneas de ≤rdenes a incluir en el reporte",
                        "required": true
                      },
                      "responses": {
                        "200": {
                          "content": {
                            "application/json": {
                              "schema": {
                                "type": "object"
                              }
                            }
                          },
                          "description": "Objeto JSON con la propiedad 'reportUrl' que contiene la URL SAS del reporte generado"
                        },
                        "400": {
                          "content": {
                            "text/plain": {
                              "schema": {
                                "type": "string"
                              }
                            }
                          },
                          "description": "Mensaje de error cuando el JSON es invßlido o no contiene ≤rdenes"
                        }
                      },
                      "summary": "Genera un reporte HTML de ≤rdenes",
                      "tags": [
                        "Reportes"
                      ]
                    }
                  },
                  "/SqlExecutor": {
                    "post": {
                      "description": "Recibe T-SQL en el body, ejecuta la consulta contra Fabric Warehouse y retorna una lista con FirstName, LastName, PrimaryEmail y FavoriteCategory.",
                      "operationId": "sqlExecutor",
                      "requestBody": {
                        "content": {
                          "application/json": {
                            "schema": {
                              "$ref": "#/components/schemas/sqlExecutorRequest"
                            }
                          }
                        },
                        "description": "Objeto JSON con la propiedad 'tsql' que contiene la consulta a ejecutar",
                        "required": true
                      },
                      "responses": {
                        "200": {
                          "content": {
                            "application/json": {
                              "schema": {
                                "items": {
                                  "$ref": "#/components/schemas/sqlExecutorCustomerRecord"
                                },
                                "type": "array"
                              }
                            }
                          },
                          "description": "Resultados tipados del segmento de clientes"
                        },
                        "400": {
                          "content": {
                            "text/plain": {
                              "schema": {
                                "type": "string"
                              }
                            }
                          },
                          "description": "Mensaje de error por body invßlido o columnas distintas al contrato esperado"
                        },
                        "500": {
                          "content": {
                            "text/plain": {
                              "schema": {
                                "type": "string"
                              }
                            }
                          },
                          "description": "Error al ejecutar la consulta SQL"
                        }
                      },
                      "summary": "Ejecuta una consulta T-SQL para segmentos de clientes",
                      "tags": [
                        "Data"
                      ]
                    }
                  }
                },
                "servers": [
                  {
                    "url": "https://func-contosoretail-siwhb.azurewebsites.net/api"
                  }
                ]
              }
            },
            "type": "openapi"
          }
        ]
      },
      "description": "",
      "id": "SqlAgent:15",
      "metadata": {
        "description": "",
        "modified_at": "1771313639"
      },
      "name": "SqlAgent",
      "object": "agent.version",
      "version": "15"
    }
  }
}
